<!DOCTYPE html>
<html>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pyodide/0.24.1/pyodide.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f8ff;
            margin: 0;
            padding: 20px;
        }
        h3 {
            color: #333;
            margin: 0 0 10px;
        }
        label {
            font-weight: bold;
        }
        select {
            font-size: 16px;
            padding: 5px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        button:disabled {
            background-color: #cccccc;
        }
        button:hover:not(:disabled) {
            background-color: #45a049;
        }
        #editor, #output {
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        #editor {
            height: 300px;
        }
        #output {
            height: 300px;
            background-color: #f9f9f9;
            overflow-y: auto;
            padding: 10px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div style="max-width: 900px; margin: auto;">
        <div id="loadingStatus" style="background: #fff3cd; color: #856404; padding: 15px; margin-bottom: 15px; border-radius: 4px; display: none;">
            Loading Python environment... This may take a few moments.
        </div>

        <!-- Dropdown for Example Questions -->
        <div style="margin-bottom: 15px;">
            <label for="exampleSelector">Choose a basic example: </label>
            <select id="exampleSelector" onchange="loadExample()" style="padding: 5px; font-size: 16px;">
                <option value="">-- Select a question --</option>
                <option value="example1">1. Print your name</option>
                <option value="example2">2. Add two numbers</option>
                <option value="example3">3. Print numbers from 1 to 5</option>
            </select>
        </div>

        <div style="display: flex; gap: 20px; margin-bottom: 20px;">
            <div style="flex: 1;">
                <h3>Python Code</h3>
                <div id="editor"></div>
            </div>
            <div style="flex: 1;">
                <h3>Output</h3>
                <div id="output">
                    <div id="outputContent"></div>
                </div>
            </div>
        </div>

        <div style="text-align: center;">
            <button onclick="runPython()" id="runButton" disabled>Run Code</button>
        </div>
    </div>

    <script>
        let editor = ace.edit("editor");
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/python");
        editor.setValue(`# Select an example from the dropdown to load a basic Python script.`);

        let pyodide;

        async function initPyodide() {
            const loadingStatus = document.getElementById('loadingStatus');
            loadingStatus.style.display = 'block';
            loadingStatus.innerText = 'Loading Python environment...';

            try {
                pyodide = await loadPyodide({ indexURL: "https://cdn.jsdelivr.net/pyodide/v0.24.1/full/" });
                await pyodide.runPythonAsync(`
                    import sys
                    import io
                    sys.stdout = io.StringIO()  # Capture Python's print output
                `);
                document.getElementById('runButton').disabled = false;
                loadingStatus.style.background = '#d4edda';
                loadingStatus.style.color = '#155724';
                loadingStatus.innerText = 'Python environment loaded successfully!';
            } catch (error) {
                loadingStatus.style.background = '#f8d7da';
                loadingStatus.style.color = '#721c24';
                loadingStatus.innerText = `Error loading Python: ${error.message}`;
            } finally {
                setTimeout(() => loadingStatus.style.display = 'none', 3000);
            }
        }
        initPyodide();

        async function runPython() {
            if (!pyodide) {
                document.getElementById("outputContent").innerText = "Python environment is not ready. Please wait...";
                return;
            }

            const code = editor.getValue();
            const outputContent = document.getElementById("outputContent");
            outputContent.innerText = ""; // Clear previous output

            try {
                await pyodide.runPythonAsync(`
                    import sys
                    import io
                    sys.stdout = io.StringIO()  # Reinitialize stdout
                `);

                await pyodide.runPythonAsync(code);

                const stdout = pyodide.runPython("sys.stdout.getvalue()");
                outputContent.innerText += stdout;
            } catch (error) {
                outputContent.innerText += `Error: ${error.message}`;
            }
        }

        function loadExample() {
            const examples = {
                "example1": `# Print your name
name = "Alice"
print(f"My name is {name}")`,
                "example2": `# Add two numbers
a = 5
b = 3
sum = a + b
print(f"The sum of {a} and {b} is {sum}")`,
                "example3": `# Print numbers from 1 to 5
for i in range(1, 6):
    print(i)`
            };

            const exampleSelector = document.getElementById("exampleSelector");
            const selectedValue = exampleSelector.value;

            if (selectedValue && examples[selectedValue]) {
                editor.setValue(examples[selectedValue]);
            } else {
                editor.setValue(`# Select an example from the dropdown to load a basic Python script.`);
            }
        }
    </script>
</body>
</html>
